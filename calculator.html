<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DTF Калькулятор - Производство печати</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Inter', sans-serif;
        }
        
        .sidebar {
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            z-index: 40;
        }
        
        .sidebar.active {
            transform: translateX(0);
        }
        
        .main-content {
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .sidebar {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 16rem;
            }
        }
        
        .nav-item {
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 4px 8px;
        }
        
        .nav-item:hover {
            background-color: #f1f5f9;
            transform: translateX(4px);
        }
        
        .nav-item.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .calculator-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-input {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .calculator-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calculator-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .margin-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .result-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid #e2e8f0;
        }
        
        .price-highlight {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }
        
        .format-item {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .format-item:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        
        .format-item.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .pricing-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .pricing-table th {
            background: #f8fafc;
            padding: 1rem;
            font-weight: 600;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .pricing-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .pricing-table tr:hover {
            background-color: #f8fafc;
        }
        
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            pointer-events: none;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #3b82f6;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .burger-menu {
            display: none;
        }
        
        @media (max-width: 767px) {
            .burger-menu {
                display: block;
            }
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .tab-button:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        
        .tab-button.active:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>
    <!-- Mobile Burger Menu -->
    <div class="burger-menu fixed top-4 left-4 z-50">
        <button id="burgerMenu" class="bg-white p-3 rounded-lg shadow-lg">
            <i class="fas fa-bars text-gray-600"></i>
        </button>
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 p-4 transform -translate-x-full md:translate-x-0">
        <div class="mb-8">
            <div class="flex items-center mb-6">
                <i class="fas fa-print text-2xl text-blue-600 mr-3"></i>
                <h1 class="text-xl font-bold text-gray-800">Печать Про</h1>
            </div>
            
            <!-- User Profile -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-user text-blue-600"></i>
                    </div>
                    <div>
                        <div id="userName" class="font-semibold text-gray-800">Пользователь</div>
                        <div id="userRole" class="text-sm text-gray-500">Менеджер</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Menu -->
        <nav class="space-y-2">
            <a href="index.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-home mr-3 w-5"></i>
                <span>Главная</span>
            </a>
            <a href="calculator.html" class="nav-item active flex items-center p-3 text-gray-700">
                <i class="fas fa-calculator mr-3 w-5"></i>
                <span>Калькулятор</span>
            </a>
            <a href="clients.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-users mr-3 w-5"></i>
                <span>Клиенты</span>
            </a>
            <a href="orders.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-clipboard-list mr-3 w-5"></i>
                <span>Заказы</span>
            </a>
            <a href="chat.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-comments mr-3 w-5"></i>
                <span>Чат</span>
            </a>
            <a href="documents.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-file-alt mr-3 w-5"></i>
                <span>Документы</span>
            </a>
            <a href="profile.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-user-cog mr-3 w-5"></i>
                <span>Профиль</span>
            </a>
            <a href="admin.html" class="nav-item flex items-center p-3 text-gray-700">
                <i class="fas fa-cog mr-3 w-5"></i>
                <span>Админ-панель</span>
            </a>
        </nav>
        
        <!-- Logout Button -->
        <div class="absolute bottom-4 left-4 right-4">
            <button id="logoutBtn" class="w-full bg-red-500 text-white p-3 rounded-lg hover:bg-red-600 transition-colors">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Выход
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 p-4">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-gray-800">DTF Калькулятор</h2>
                
                <div class="flex items-center space-x-4">
                    <!-- Technology Tabs -->
                    <div class="flex space-x-2">
                        <button class="tab-button active" onclick="switchTechnology('DTF')">DTF</button>
                        <button class="tab-button" onclick="switchTechnology('UV')">UV</button>
                        <button class="tab-button" onclick="switchTechnology('Sublimation')">Сублимация</button>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="relative">
                        <button id="notificationBtn" class="relative p-2 text-gray-600 hover:text-gray-800">
                            <i class="fas fa-bell text-xl"></i>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Calculator Content -->
        <div class="p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Calculator Form -->
                <div class="calculator-card p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-6">Параметры расчета</h3>
                    
                    <form id="calculatorForm" class="space-y-6">
                        <!-- Format Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Формат изображения</label>
                            <div class="format-grid">
                                <div class="format-item selected" data-format="A3" onclick="selectFormat('A3')">
                                    <div class="font-semibold">A3</div>
                                    <div class="text-xs text-gray-500">29.7×42.0 см</div>
                                    <div class="text-xs text-gray-400">до 3 шт</div>
                                </div>
                                <div class="format-item" data-format="A4" onclick="selectFormat('A4')">
                                    <div class="font-semibold">A4</div>
                                    <div class="text-xs text-gray-500">21.0×29.7 см</div>
                                    <div class="text-xs text-gray-400">до 6 шт</div>
                                </div>
                                <div class="format-item" data-format="A5" onclick="selectFormat('A5')">
                                    <div class="font-semibold">A5</div>
                                    <div class="text-xs text-gray-500">14.8×21.0 см</div>
                                    <div class="text-xs text-gray-400">до 12 шт</div>
                                </div>
                                <div class="format-item" data-format="A6" onclick="selectFormat('A6')">
                                    <div class="font-semibold">A6</div>
                                    <div class="text-xs text-gray-500">10.5×14.8 см</div>
                                    <div class="text-xs text-gray-400">до 30 шт</div>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Dimensions -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="width" class="block text-sm font-medium text-gray-700 mb-2">Ширина (см)</label>
                                <input type="number" id="width" class="form-input w-full" value="29.7" step="0.1" min="1" max="100">
                            </div>
                            <div>
                                <label for="height" class="block text-sm font-medium text-gray-700 mb-2">Высота (см)</label>
                                <input type="number" id="height" class="form-input w-full" value="42.0" step="0.1" min="1" max="100">
                            </div>
                        </div>

                        <!-- Quantity -->
                        <div>
                            <label for="quantity" class="block text-sm font-medium text-gray-700 mb-2">Количество изделий</label>
                            <input type="number" id="quantity" class="form-input w-full" value="100" min="1" max="10000">
                        </div>

                        <!-- Complexity -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Сложность работы</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300">
                                    <input type="radio" name="complexity" value="easy" class="mr-3" checked>
                                    <div>
                                        <div class="font-medium">Лёгкая</div>
                                        <div class="text-sm text-gray-500">Простые изображения</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300">
                                    <input type="radio" name="complexity" value="difficult" class="mr-3">
                                    <div>
                                        <div class="font-medium">Сложная</div>
                                        <div class="text-sm text-gray-500">Детальные изображения</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Print Sides -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Печать</label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300">
                                    <input type="radio" name="sides" value="single" class="mr-3" checked>
                                    <div>
                                        <div class="font-medium">Односторонняя</div>
                                        <div class="text-sm text-gray-500">Печать с одной стороны</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300">
                                    <input type="radio" name="sides" value="double" class="mr-3">
                                    <div>
                                        <div class="font-medium">Двусторонняя</div>
                                        <div class="text-sm text-gray-500">Печать с двух сторон</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Calculate Button -->
                        <button type="button" onclick="calculatePrice()" class="calculator-btn w-full">
                            <i class="fas fa-calculator mr-2"></i>
                            Рассчитать стоимость
                        </button>
                    </form>
                </div>

                <!-- Results Panel -->
                <div class="space-y-6">
                    <!-- Price Result -->
                    <div id="priceResult" class="result-card hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Результаты расчета</h3>
                        
                        <div class="price-highlight mb-6">
                            <div class="text-sm opacity-90">Итоговая стоимость</div>
                            <div id="totalPrice" class="text-3xl font-bold">0 ₽</div>
                            <div id="unitPrice" class="text-sm opacity-90">0 ₽ за единицу</div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-800" id="totalArea">0 м²</div>
                                <div class="text-sm text-gray-500">Общая площадь</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-800" id="sheetsNeeded">0</div>
                                <div class="text-sm text-gray-500">Листов необходимо</div>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Печать:</span>
                                <span class="font-medium" id="printCost">0 ₽</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Переносы:</span>
                                <span class="font-medium" id="transferCost">0 ₽</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Коэффициент сложности:</span>
                                <span class="font-medium" id="complexityMultiplier">×1</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Коэффициент сторон:</span>
                                <span class="font-medium" id="sidesMultiplier">×1</span>
                            </div>
                        </div>

                        <!-- Margin Button -->
                        <button id="marginBtn" onclick="applyMargin()" class="calculator-btn margin-btn w-full mt-6 hidden">
                            <i class="fas fa-fire mr-2"></i>
                            Применить маржу (фейерверк!)
                        </button>

                        <!-- Action Buttons -->
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <button onclick="createQuote()" class="calculator-btn bg-green-600 hover:bg-green-700">
                                <i class="fas fa-file-invoice mr-2"></i>
                                Создать КП
                            </button>
                            <button onclick="sendToProduction()" class="calculator-btn bg-purple-600 hover:bg-purple-700">
                                <i class="fas fa-industry mr-2"></i>
                                В производство
                            </button>
                        </div>
                    </div>

                    <!-- Pricing Tables -->
                    <div class="calculator-card p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Таблицы цен</h3>
                        
                        <!-- Print Pricing -->
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-700 mb-3">Печать по метрам</h4>
                            <div class="pricing-table">
                                <table class="w-full">
                                    <thead>
                                        <tr>
                                            <th>Объем (м²)</th>
                                            <th>Цена (₽)</th>
                                            <th>Время</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1-5</td>
                                            <td>1100</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>5-10</td>
                                            <td>1000</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>10-30</td>
                                            <td>900</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>30-50</td>
                                            <td>850</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>50-100</td>
                                            <td>800</td>
                                            <td>2 дня</td>
                                        </tr>
                                        <tr>
                                            <td>100-1000</td>
                                            <td>750</td>
                                            <td>от 2 до 9 дней</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Transfer Pricing -->
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-700 mb-3">Переносы на одежду</h4>
                            <div class="pricing-table">
                                <table class="w-full">
                                    <thead>
                                        <tr>
                                            <th>Объем (шт)</th>
                                            <th>Цена (₽)</th>
                                            <th>Время</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>10</td>
                                            <td>100</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>50</td>
                                            <td>55</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>100</td>
                                            <td>50</td>
                                            <td>1 день</td>
                                        </tr>
                                        <tr>
                                            <td>500</td>
                                            <td>45</td>
                                            <td>2 дня</td>
                                        </tr>
                                        <tr>
                                            <td>1000</td>
                                            <td>40</td>
                                            <td>3-4 дня</td>
                                        </tr>
                                        <tr>
                                            <td>1000-10000</td>
                                            <td>35</td>
                                            <td>обговаривается</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Packaging Pricing -->
                        <div>
                            <h4 class="font-medium text-gray-700 mb-3">Упаковка</h4>
                            <div class="pricing-table">
                                <table class="w-full">
                                    <thead>
                                        <tr>
                                            <th>Объем (шт)</th>
                                            <th>Упаковка (₽)</th>
                                            <th>ШК (₽)</th>
                                            <th>Пакет (₽)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>10</td>
                                            <td>30</td>
                                            <td>4</td>
                                            <td>8</td>
                                        </tr>
                                        <tr>
                                            <td>50</td>
                                            <td>25</td>
                                            <td>4</td>
                                            <td>8</td>
                                        </tr>
                                        <tr>
                                            <td>100</td>
                                            <td>23</td>
                                            <td>4</td>
                                            <td>8</td>
                                        </tr>
                                        <tr>
                                            <td>500</td>
                                            <td>20</td>
                                            <td>4</td>
                                            <td>8</td>
                                        </tr>
                                        <tr>
                                            <td>1000</td>
                                            <td>20</td>
                                            <td>3</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>1000-10000</td>
                                            <td>19</td>
                                            <td>3</td>
                                            <td>7</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Celebration Container -->
    <div id="celebrationContainer" class="celebration hidden"></div>

    <script src="main.js"></script>
    <script>
        let currentFormat = 'A3';
        let calculationData = null;

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            if (!system.currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            system.updateUI();
            loadCalculatorData();
        });

        function loadCalculatorData() {
            // Load pricing data from system
            const calculator = system.db.calculators.find(c => c.id === 'dtf_calculator');
            if (calculator) {
                // Pricing tables are already in the HTML, but could be dynamically loaded here
                console.log('Calculator data loaded:', calculator);
            }
        }

        function selectFormat(format) {
            // Update selected format
            document.querySelectorAll('.format-item').forEach(item => {
                item.classList.remove('selected');
            });
            document.querySelector(`[data-format="${format}"]`).classList.add('selected');
            
            currentFormat = format;
            
            // Update dimensions based on format
            const calculator = system.db.calculators.find(c => c.id === 'dtf_calculator');
            if (calculator && calculator.pricing.formats[format]) {
                const formatData = calculator.pricing.formats[format];
                document.getElementById('width').value = formatData.width;
                document.getElementById('height').value = formatData.height;
            }
        }

        function calculatePrice() {
            const width = parseFloat(document.getElementById('width').value);
            const height = parseFloat(document.getElementById('height').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const complexity = document.querySelector('input[name="complexity"]:checked').value;
            const sides = document.querySelector('input[name="sides"]:checked').value;
            
            // Validate inputs
            if (!width || !height || !quantity) {
                alert('Пожалуйста, заполните все обязательные поля');
                return;
            }
            
            // Calculate using system calculator
            const result = system.calculateDTF(currentFormat, width, height, quantity, complexity, sides);
            
            if (result) {
                calculationData = result;
                displayResults(result);
            }
        }

        function displayResults(result) {
            // Show results panel
            document.getElementById('priceResult').classList.remove('hidden');
            
            // Update price display
            document.getElementById('totalPrice').textContent = system.formatCurrency(result.totalCost);
            document.getElementById('unitPrice').textContent = system.formatCurrency(result.unitPrice) + ' за единицу';
            
            // Update other values
            document.getElementById('totalArea').textContent = result.totalArea.toFixed(2) + ' м²';
            document.getElementById('sheetsNeeded').textContent = result.sheetsNeeded;
            document.getElementById('printCost').textContent = system.formatCurrency(result.printCost);
            document.getElementById('transferCost').textContent = system.formatCurrency(result.transferCost);
            document.getElementById('complexityMultiplier').textContent = '×' + result.complexityMultiplier;
            document.getElementById('sidesMultiplier').textContent = '×' + result.sidesMultiplier;
            
            // Show margin button
            document.getElementById('marginBtn').classList.remove('hidden');
            
            // Scroll to results
            document.getElementById('priceResult').scrollIntoView({ behavior: 'smooth' });
        }

        function applyMargin() {
            if (!calculationData) return;
            
            // Apply 30% margin
            const marginMultiplier = 1.3;
            const newPrice = calculationData.totalCost * marginMultiplier;
            
            // Update display
            document.getElementById('totalPrice').textContent = system.formatCurrency(newPrice);
            document.getElementById('unitPrice').textContent = system.formatCurrency(newPrice / calculationData.quantity) + ' за единицу';
            
            // Show celebration
            showCelebration();
            
            // Update calculation data
            calculationData.totalCost = newPrice;
            calculationData.unitPrice = newPrice / calculationData.quantity;
            calculationData.marginApplied = true;
            
            // Hide margin button
            document.getElementById('marginBtn').classList.add('hidden');
            
            // Log action
            system.logAction('margin_applied', `Маржа применена к расчету: +30% = ${system.formatCurrency(newPrice)}`);
        }

        function showCelebration() {
            const container = document.getElementById('celebrationContainer');
            container.classList.remove('hidden');
            
            // Create confetti
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.backgroundColor = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'][Math.floor(Math.random() * 5)];
                container.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.parentNode.removeChild(confetti);
                    }
                }, 3000);
            }
            
            // Hide container after animation
            setTimeout(() => {
                container.classList.add('hidden');
            }, 3000);
        }

        function createQuote() {
            if (!calculationData) {
                alert('Сначала выполните расчет');
                return;
            }
            
            // Create order in system
            const orderData = {
                title: `DTF печать ${currentFormat} формат`,
                clientId: 'client_001', // Default client for demo
                calculatorData: {
                    technology: 'DTF',
                    format: currentFormat,
                    quantity: parseInt(document.getElementById('quantity').value),
                    complexity: document.querySelector('input[name="complexity"]:checked').value,
                    sides: document.querySelector('input[name="sides"]:checked').value,
                    totalMeters: calculationData.totalArea,
                    unitPrice: calculationData.unitPrice,
                    totalPrice: calculationData.totalCost
                }
            };
            
            const order = system.createOrder(orderData);
            
            // Generate document
            const document = system.generateDocument('quote', order.id);
            
            alert(`КП успешно создан! Номер заказа: ${order.id}`);
            
            // Redirect to documents page
            setTimeout(() => {
                window.location.href = 'documents.html';
            }, 1000);
        }

        function sendToProduction() {
            if (!calculationData) {
                alert('Сначала выполните расчет');
                return;
            }
            
            // Create notification for production
            system.createNotification('production_request', 'Запрос в производство', 'Новый заказ готов к производству');
            
            alert('Заказ отправлен в производство!');
        }

        function switchTechnology(tech) {
            // Update active tab
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // For demo, just show alert
            if (tech !== 'DTF') {
                alert(`Технология ${tech} будет доступна в следующей версии системы`);
                // Switch back to DTF
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('[onclick="switchTechnology(\'DTF\')"]').classList.add('active');
            }
        }

        // Mobile sidebar toggle
        document.getElementById('burgerMenu').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
        });
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const burgerMenu = document.getElementById('burgerMenu');
            
            if (window.innerWidth < 768 && 
                !sidebar.contains(e.target) && 
                !burgerMenu.contains(e.target) && 
                sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        });
    </script>
</body>
</html>